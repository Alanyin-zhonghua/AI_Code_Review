# 实时跟随

## 2025-03-15
- 新增 `TaskConfig` 配置，强制任务模式（read_only / safe_write）、项目根目录和 trace_id，所有任务入口 `run_agent` 必须显式传入。
- 引入 `LocalFileToolProvider` + `FileToolProvider` 抽象，所有读写工具走同一网关，写入必定经过备份与路径校验，为未来 MCP Provider 预留接口。
- 在 `agent_core.tasks.task_runner.run_agent` 中实现最多 20 步的多轮工具循环：模型自行决定是否继续调用工具，我们只负责执行、回填结果并强制步数上限。
- 对每个任务落地 JSON trace（`traces/{trace_id}.json`），记录 LLM 响应、工具调用、错误、最终状态，方便后续审计与回溯。
- 工具有了新的结构化定义（read/list/search/write），并自动根据 `TaskConfig.mode` 拒绝写操作。
- GUI 侧：`agent_core/gui/test_gui.py` 增加“项目目录”选择（绑定 `self.project_root`），以及“任务Agent”按钮，调用 `TaskConfig` + `run_agent`，只有在选定 project_root 且配置了 API Key 时才能执行任务。
